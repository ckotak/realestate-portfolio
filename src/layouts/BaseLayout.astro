---
import '@fontsource/inter/400.css';
import '@fontsource/inter/600.css';
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
}

const {
  title = "Chetan Kotak | Real Estate Agent",
  description = "Premium real estate services. Expert guidance, unmatched market knowledge, and a relentless commitment to getting you the best deal — every time."
} = Astro.props;

const siteUrl = 'https://chetankotak.github.io/realestate-portfolio';
const ogImage = `${siteUrl}/og-image.png`;

// Structured data — swap out placeholders before going live
const schema = {
  "@context": "https://schema.org",
  "@type": ["Person", "RealEstateAgent"],
  "name": "Chetan Kotak",
  "jobTitle": "Licensed Real Estate Agent",
  "description": description,
  "url": siteUrl,
  "image": ogImage,
  "telephone": "+1-415-555-0100",          // TODO: replace with real number
  "email": "chetan@example.com",            // TODO: replace with real email
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "San Francisco",     // TODO: replace with actual city
    "addressRegion": "CA",
    "addressCountry": "US"
  },
  "areaServed": {
    "@type": "Place",
    "name": "Bay Area, California"
  },
  "hasCredential": {
    "@type": "EducationalOccupationalCredential",
    "credentialCategory": "Real Estate License",
    "identifier": "DRE #XXXXXXX",          // TODO: replace with real DRE license number
    "recognizedBy": {
      "@type": "Organization",
      "name": "California Department of Real Estate"
    }
  },
  "sameAs": [
    "https://twitter.com/chetankotak",      // TODO: replace with real Twitter/X handle
    "https://linkedin.com/in/chetankotak"   // TODO: replace with real LinkedIn URL
  ]
};

const base = import.meta.env.BASE_URL;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Security headers (GitHub Pages cannot set HTTP headers; meta is the available mechanism) -->
  <!--
    CSP notes:
    - script-src 'unsafe-inline': required for Astro's inlined module scripts (nav toggle, scroll observer)
    - style-src 'unsafe-inline': required for inline style attributes (transition-delay on cards)
    - frame-ancestors 'none': clickjacking protection (CSP equivalent of X-Frame-Options: DENY)
    - form-action 'mailto:': only allow the mailto: contact link, no form submissions elsewhere
    - X-Content-Type-Options and Permissions-Policy cannot be set via meta — HTTP headers only
  -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data:;
    connect-src 'none';
    frame-ancestors 'none';
    base-uri 'self';
    form-action 'mailto:';
  " />
  <meta http-equiv="X-Frame-Options" content="DENY" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- Primary SEO -->
  <title>{title}</title>
  <meta name="description" content={description} />
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <link rel="canonical" href={siteUrl} />

  <!-- Open Graph (Facebook, LinkedIn, iMessage, Slack, etc.) -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Chetan Kotak Real Estate" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:url" content={siteUrl} />
  <meta property="og:image" content={ogImage} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="Chetan Kotak — Licensed Real Estate Agent" />
  <meta property="og:locale" content="en_US" />

  <!-- Twitter / X Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@chetankotak" />       <!-- TODO: replace with real handle -->
  <meta name="twitter:creator" content="@chetankotak" />    <!-- TODO: replace with real handle -->
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImage} />
  <meta name="twitter:image:alt" content="Chetan Kotak — Licensed Real Estate Agent" />

  <!-- AI / LLM crawlers: inherits the robots directive above -->

  <!-- Schema.org structured data (Google, AI search, rich results) -->
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href={`${base.replace(/\/$/, '')}/favicon.svg`} />

  <!-- Bebas Neue via Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap"
    rel="stylesheet"
  />
</head>
<body>
  <slot />

  <script>
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.15 }
    );

    document.querySelectorAll('.reveal').forEach((el) => observer.observe(el));
  </script>
</body>
</html>
